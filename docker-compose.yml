version: '3.3'

services:
  SkinnyWSSO:
    image: golang:latest
    restart: always
    ports:
      - "443:443"
      - "80:80"
    networks:
      - skinnywsso
    environment:
      LDAP_ADMIN_PASSWORD: "$ldapadminpassword"
      USE_HTTPS: "true"
      CERT_PATH: "/opt/skinny_wsso/tls/cert.pem"
      KEY_PATH: "/opt/skinny_wsso/tls/key.pem"
    working_dir: /opt/skinny_wsso
    volumes:
      - C:/users/evanj/Documents/SkinnyWSSO/:/opt/skinny_wsso:ro
    command: /bin/bash -c 'go run .'

  ldap:
    image: osixia/openldap:latest
    restart: always
    ports:
      - "389:389"
    environment:
      LDAP_ORGANISATION: "Skinny WSSO"
      LDAP_DOMAIN: "skinny.wsso"
      LDAP_ADMIN_PASSWORD: "$ldapadminpassword"
    networks:
      - skinnywsso
    # LDAP needs a volume to persist data
    volumes:
      - ldap_data:/var/lib/ldap
      - ldap_slapd:/etc/ldap/slapd.d
      - C:/users/evanj/Documents/SkinnyWSSO/:/opt/skinny_wsso:ro
    working_dir: /opt/skinny_wsso

networks:
  skinnywsso:

volumes:
  ldap_data:
  ldap_slapd: